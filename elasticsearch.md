تعداد داکیومنت های ایندکس

http://localhost:9200/exploit/_count

ساخت ایندکس جدید

PUT  http://192.168.13.248:9200/exploit

حذف ایندکس

DELETE  http://192.168.13.248:9200/exploit

گرفتن داکیومنت

http://192.168.13.248:9200/exploit/_doc/5

گرفتن داکیومنت بدون متا دیتا

http://192.168.13.248:9200/exploit/_source/5

گرفتن  مالتی داکیومنت ( مطالعه شود mget )

http://192.168.13.248:9200/exploit/_mget

لیست داکیومنت

http://192.168.13.196:9200/exploit/_search/?size=1000&pretty=true

لیست ایندکس ها

http://localhost:9200/_cat/indices?v=true

# mget

اگر بخوایم مشخص کنیم چه فیلد هایی می خواییم و چه فیلد هایی نمی خواییم :

GET /_mget

        {
          "docs": [
            {
              "_index": "my-index-000001",               مشخص می کنیم بر روی کدام ایندکس
              "_id": "1",                                 مشخص می کنیم بر روی کدام ایدی
              "_source": [ "field3", "field4" ],           مشخص می کنیم  کدام فیلد ها رو می خوایم
            },
            {
              "_index": "my-index-000001",
              "_id": "2",
                        "_source": {
                        "include": [ "user" ],                       مشخص می کنیم  کدام فیلد ها رو می خوایم
                        "exclude": [ "user.location" ]                مشخص می کنیم  کدام فیلد ها رو نمی خوایم
                        "stored_fields": [ "field1", "field2" ]         ترتیب
                        "routing": "key2"                               انتخاب شارد
                      }
            }
          ]
        }



# query

خیلی قوی تر از مالتی گت هست و داخل سرچ استفاده میشود

شامل دو دسته میشود : لیف کويری ها که ساده هستند و بدون بول یا نستد استفاده می شوند - کامپوند کوییری ها که ترکیبی اند و پر کاربرد ترینش بول هست 

درون api search قرار دارد و بعد از کوییری ، می بایست مشخص کینم

___ leaf query





match -------
  در مچ باید کلمات دقیق باشند .

prefix -------
اگر ابتدای کلمه را می دانیم باید از prefix استفاده کنیم .

match_phrase -----
ترتیب عبارت هم مهم است .

fuzzy -----
غلط های املایی رو درست می کنه .

term ------ 
زمانی که می خوهیم سرچ دقیق بر روی عدد تاریخ یا استیرینگ بزنیم ، توجه شود روی تکست کار نمی کند .

range -------- 
ترم لول است و بازه ای از نوع مشخص یگیرد






        GET /_search
        {
          "_source" : ["title" , "age " ] ,         مشخص می کنه چه فیلد هایی و ترتیب آنها
          "query": {                                باید درون کوییری مشخص کنیم که match , term , range ,....
            "match": {                                   در متچ ، باید کله دقیق برابر مقدار باشد تا پیدا شود ، مقدار اول کلید و مقدار دوم متن مورد نظر هست
              "field1": {                                                        فیلدی که در مچ باید جستوجو درون آن انجام شود
                "query":
                      {
                        "query": "Programs Rating",                متن جستوجو
                        "operator": "and" ,                        باید تمام متن در خروجی باشد
                        "fuzziness": "AUTO",                        اجازه می دهد که به صورت فازی سرچ کنیم
                      }

              }
            }
          }
        }


___ compound query

ابتدا یک آبجکت بول میسازیم و ۴ روش برای ایجاد کامپوند کویری داریم : درون موارد زیر می توانیم شرایط لیف کویری رو بنویسیم .توجه شود در هر کدام از موارد زیر میتوان چند شرط لیف کوییری گذاشت .

must -------
که یعنی باید درون کویری شرط های آن باشد

should ----- 
اگر شرط های این باشه امتیاز آن بالا تر می ره . به عبارت دیگر اگر ریزالت ما ۴۰ تا باشه ، شولد هیچ تاثیری توی تعداد نتایج نداره ، اما تو نمره و ترتیب آنها نقش داره .

filter ----- 
در نهایت می توان با فیلتر ، خروجی را فیلتر کرد . همچنین می توان گفت ترم لول ها درون فیلتر قرار می گیرند ، مثل term , range

must_not ---- 
نباید این شرط ها درون نتیجه باشد .


        POST exploit/_search
        {
          "size": 10,
          "query": {
            "bool": {
              "must": [
                {
                  "match": {
                    "type": {
                      "query": "Linux Kernel",
                      "operator": "and"
                    }
                  }
                },
                {
                  "match": {
                    "platform": {
                      "query": "Linux mac",
                      "operator": "or"
                    }
                  }
                }
              ],
              "filter": [
                {
                  "range": {
                    "date": { "gte" : "2007-12-29T00:00:00Z", "lte" : "2023-12-29T00:00:00Z" } 
                  }
                }
              ]
            }
          }
        }





اگر بخواهیم درون یک کوییری چند شرط بزاریم ، باید از bool استفاده کنیم ، خود بول باید یکی از موارد must و filter و should و must_not را بگیرد .

اینسرت تکی

curl -POST 'localhost:9200/exploit/_doc' -H 'Content-Type: application/json' -d'
{
        "timestamp": "2018-01-24 12:34:56",
        "message": "User logged in",
        "user_id": 4,
        "admin": false
} '

curl -X PUT "localhost:9200/exploit/_bulk?pretty" -H 'Content-Type: application/json' -d'
{ "create": { } }
{ "@timestamp": "2099-05-07T16:24:32.000Z", "event": { "original": "192.0.2.242 - - [07/May/2020:16:24:32 -0500] \"GET /images/hm_nbg.jpg HTTP/1.0\" 304 0" } }
{ "create": { } }
{ "@timestamp": "2099-05-08T16:25:42.000Z", "event": { "original": "192.0.2.255 - - [08/May/2099:16:25:42 +0000] \"GET /favicon.ico HTTP/1.0\" 200 3638" } }
'

مرتب بر اساس آیدی

http://192.168.13.248:9200/exploit/_search/?size=1000&pretty=true&sort=_id
